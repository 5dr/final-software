!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define("MediaImageStudio",[],e):"object"==typeof exports?exports.MediaImageStudio=e():t.MediaImageStudio=e()}("undefined"!=typeof self?self:this,function(){return function(t){var e={};function r(n){if(e[n])return e[n].exports;var i=e[n]={i:n,l:!1,exports:{}};return t[n].call(i.exports,i,i.exports,r),i.l=!0,i.exports}return r.m=t,r.c=e,r.d=function(t,e,n){r.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},r.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)r.d(n,i,function(e){return t[e]}.bind(null,i));return n},r.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="https://static.parastorage.com/services/media-image-studio-opener/1.0.0/",r.p="undefined"!=typeof window&&window.__STATICS_BASE_URL__||r.p,r(r.s=12)}([function(t,e,r){var n={EventEmitter:r(4),EmitterSubscription:r(1)};t.exports=n},function(t,e,r){"use strict";var n=function(t){function e(r,n,i){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),t.call(this,r),this.listener=n,this.context=i}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),e}(r(5));t.exports=n},function(t,e,r){"use strict";var n=function(t){};t.exports=function(t,e,r,i,o,s,a,u){if(n(e),!t){var c;if(void 0===e)c=new Error("Minified exception occurred; use the non-minified dev environment for the full error message and additional helpful warnings.");else{var f=[r,i,o,s,a,u],p=0;(c=new Error(e.replace(/%s/g,function(){return f[p++]}))).name="Invariant Violation"}throw c.framesToPop=1,c}}},function(t,e,r){var n=r(8);"string"==typeof n&&(n=[[t.i,n,""]]);var i={singleton:!0,transform:void 0};r(10)(n,i);n.locals&&(t.exports=n.locals)},function(t,e,r){"use strict";var n=r(1),i=r(6),o=r(7),s=r(2),a=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this._subscriber=new i,this._currentSubscription=null}return t.prototype.addListener=function(t,e,r){return this._subscriber.addSubscription(t,new n(this._subscriber,e,r))},t.prototype.once=function(t,e,r){var n=this;return this.addListener(t,function(){n.removeCurrentListener(),e.apply(r,arguments)})},t.prototype.removeAllListeners=function(t){this._subscriber.removeAllSubscriptions(t)},t.prototype.removeCurrentListener=function(){this._currentSubscription||s(!1),this._subscriber.removeSubscription(this._currentSubscription)},t.prototype.listeners=function(t){var e=this._subscriber.getSubscriptionsForType(t);return e?e.filter(o.thatReturnsTrue).map(function(t){return t.listener}):[]},t.prototype.emit=function(t){var e=this._subscriber.getSubscriptionsForType(t);if(e){for(var r=Object.keys(e),n=0;n<r.length;n++){var i=e[r[n]];i&&(this._currentSubscription=i,this.__emitToSubscription.apply(this,[i].concat(Array.prototype.slice.call(arguments))))}this._currentSubscription=null}},t.prototype.__emitToSubscription=function(t,e){var r=Array.prototype.slice.call(arguments,2);t.listener.apply(t.context,r)},t}();t.exports=a},function(t,e,r){"use strict";var n=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.subscriber=e}return t.prototype.remove=function(){this.subscriber&&(this.subscriber.removeSubscription(this),this.subscriber=null)},t}();t.exports=n},function(t,e,r){"use strict";var n=r(2),i=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this._subscriptionsForType={},this._currentSubscription=null}return t.prototype.addSubscription=function(t,e){e.subscriber!==this&&n(!1),this._subscriptionsForType[t]||(this._subscriptionsForType[t]=[]);var r=this._subscriptionsForType[t].length;return this._subscriptionsForType[t].push(e),e.eventType=t,e.key=r,e},t.prototype.removeAllSubscriptions=function(t){void 0===t?this._subscriptionsForType={}:delete this._subscriptionsForType[t]},t.prototype.removeSubscription=function(t){var e=t.eventType,r=t.key,n=this._subscriptionsForType[e];n&&delete n[r]},t.prototype.getSubscriptionsForType=function(t){return this._subscriptionsForType[t]},t}();t.exports=i},function(t,e,r){"use strict";function n(t){return function(){return t}}var i=function(){};i.thatReturns=n,i.thatReturnsFalse=n(!1),i.thatReturnsTrue=n(!0),i.thatReturnsNull=n(null),i.thatReturnsThis=function(){return this},i.thatReturnsArgument=function(t){return t},t.exports=i},function(t,e,r){(e=t.exports=r(9)(!1)).push([t.i,"._1NZ04{position:fixed;top:0;left:0;z-index:6001;width:100%;height:100%;border:0}",""]),e.locals={mediaImageStudio:"_1NZ04"}},function(t,e){t.exports=function(t){var e=[];return e.toString=function(){return this.map(function(e){var r=function(t,e){var r=t[1]||"",n=t[3];if(!n)return r;if(e&&"function"==typeof btoa){var i=function(t){return"/*# sourceMappingURL=data:application/json;charset=utf-8;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(t))))+" */"}(n),o=n.sources.map(function(t){return"/*# sourceURL="+n.sourceRoot+t+" */"});return[r].concat(o).concat([i]).join("\n")}return[r].join("\n")}(e,t);return e[2]?"@media "+e[2]+"{"+r+"}":r}).join("")},e.i=function(t,r){"string"==typeof t&&(t=[[null,t,""]]);for(var n={},i=0;i<this.length;i++){var o=this[i][0];"number"==typeof o&&(n[o]=!0)}for(i=0;i<t.length;i++){var s=t[i];"number"==typeof s[0]&&n[s[0]]||(r&&!s[2]?s[2]=r:r&&(s[2]="("+s[2]+") and ("+r+")"),e.push(s))}},e}},function(t,e,r){var n={},i=function(t){var e;return function(){return void 0===e&&(e=t.apply(this,arguments)),e}}(function(){return window&&document&&document.all&&!window.atob}),o=function(t){var e={};return function(t){return void 0===e[t]&&(e[t]=function(t){return document.querySelector(t)}.call(this,t)),e[t]}}(),s=null,a=0,u=[],c=r(11);function f(t,e){for(var r=0;r<t.length;r++){var i=t[r],o=n[i.id];if(o){o.refs++;for(var s=0;s<o.parts.length;s++)o.parts[s](i.parts[s]);for(;s<i.parts.length;s++)o.parts.push(v(i.parts[s],e))}else{var a=[];for(s=0;s<i.parts.length;s++)a.push(v(i.parts[s],e));n[i.id]={id:i.id,refs:1,parts:a}}}}function p(t,e){for(var r=[],n={},i=0;i<t.length;i++){var o=t[i],s=e.base?o[0]+e.base:o[0],a={css:o[1],media:o[2],sourceMap:o[3]};n[s]?n[s].parts.push(a):r.push(n[s]={id:s,parts:[a]})}return r}function l(t,e){var r=o(t.insertInto);if(!r)throw new Error("Couldn't find a style target. This probably means that the value for the 'insertInto' parameter is invalid.");var n=u[u.length-1];if("top"===t.insertAt)n?n.nextSibling?r.insertBefore(e,n.nextSibling):r.appendChild(e):r.insertBefore(e,r.firstChild),u.push(e);else{if("bottom"!==t.insertAt)throw new Error("Invalid value for parameter 'insertAt'. Must be 'top' or 'bottom'.");r.appendChild(e)}}function d(t){if(null===t.parentNode)return!1;t.parentNode.removeChild(t);var e=u.indexOf(t);e>=0&&u.splice(e,1)}function h(t){var e=document.createElement("style");return t.attrs.type="text/css",m(e,t.attrs),l(t,e),e}function m(t,e){Object.keys(e).forEach(function(r){t.setAttribute(r,e[r])})}function v(t,e){var r,n,i,o;if(e.transform&&t.css){if(!(o=e.transform(t.css)))return function(){};t.css=o}if(e.singleton){var u=a++;r=s||(s=h(e)),n=b.bind(null,r,u,!1),i=b.bind(null,r,u,!0)}else t.sourceMap&&"function"==typeof URL&&"function"==typeof URL.createObjectURL&&"function"==typeof URL.revokeObjectURL&&"function"==typeof Blob&&"function"==typeof btoa?(r=function(t){var e=document.createElement("link");return t.attrs.type="text/css",t.attrs.rel="stylesheet",m(e,t.attrs),l(t,e),e}(e),n=function(t,e,r){var n=r.css,i=r.sourceMap,o=void 0===e.convertToAbsoluteUrls&&i;(e.convertToAbsoluteUrls||o)&&(n=c(n));i&&(n+="\n/*# sourceMappingURL=data:application/json;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(i))))+" */");var s=new Blob([n],{type:"text/css"}),a=t.href;t.href=URL.createObjectURL(s),a&&URL.revokeObjectURL(a)}.bind(null,r,e),i=function(){d(r),r.href&&URL.revokeObjectURL(r.href)}):(r=h(e),n=function(t,e){var r=e.css,n=e.media;n&&t.setAttribute("media",n);if(t.styleSheet)t.styleSheet.cssText=r;else{for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(document.createTextNode(r))}}.bind(null,r),i=function(){d(r)});return n(t),function(e){if(e){if(e.css===t.css&&e.media===t.media&&e.sourceMap===t.sourceMap)return;n(t=e)}else i()}}t.exports=function(t,e){if("undefined"!=typeof DEBUG&&DEBUG&&"object"!=typeof document)throw new Error("The style-loader cannot be used in a non-browser environment");(e=e||{}).attrs="object"==typeof e.attrs?e.attrs:{},e.singleton||(e.singleton=i()),e.insertInto||(e.insertInto="head"),e.insertAt||(e.insertAt="bottom");var r=p(t,e);return f(r,e),function(t){for(var i=[],o=0;o<r.length;o++){var s=r[o];(a=n[s.id]).refs--,i.push(a)}t&&f(p(t,e),e);for(o=0;o<i.length;o++){var a;if(0===(a=i[o]).refs){for(var u=0;u<a.parts.length;u++)a.parts[u]();delete n[a.id]}}}};var y=function(){var t=[];return function(e,r){return t[e]=r,t.filter(Boolean).join("\n")}}();function b(t,e,r,n){var i=r?"":n.css;if(t.styleSheet)t.styleSheet.cssText=y(e,i);else{var o=document.createTextNode(i),s=t.childNodes;s[e]&&t.removeChild(s[e]),s.length?t.insertBefore(o,s[e]):t.appendChild(o)}}},function(t,e){t.exports=function(t){var e="undefined"!=typeof window&&window.location;if(!e)throw new Error("fixUrls requires window.location");if(!t||"string"!=typeof t)return t;var r=e.protocol+"//"+e.host,n=r+e.pathname.replace(/\/[^\/]*$/,"/");return t.replace(/url\s*\(((?:[^)(]|\((?:[^)(]+|\([^)(]*\))*\))*)\)/gi,function(t,e){var i,o=e.trim().replace(/^"(.*)"$/,function(t,e){return e}).replace(/^'(.*)'$/,function(t,e){return e});return/^(#|data:|http:\/\/|https:\/\/|file:\/\/\/)/i.test(o)?t:(i=0===o.indexOf("//")?o:0===o.indexOf("/")?r+o:n+o.replace(/^\.\//,""),"url("+JSON.stringify(i)+")")})}},function(t,e,r){"use strict";r.r(e);var n,i,o=r(0);!function(t){t.Default="",t.Transform="transform",t.Filters="filters",t.Adjust="adjust",t.Cutout="cutout"}(n||(n={})),function(t){t.ImageData="imageData",t.Close="close"}(i||(i={}));var s,a=r(3);!function(t){t.FRAME_CLOSE="MEDIA_IMAGE_STUDIO.FRAME_CLOSE",t.IMAGE_DATA="MEDIA_IMAGE_STUDIO.IMAGE_DATA",t.READY="MEDIA_IMAGE_STUDIO.READY"}(s||(s={}));var u,c=["http://local.wix.com:3010","https://apps.wix.com",""],f=function(t){return t.data},p=function(){function t(t,e){void 0===e&&(e={debug:!1});var r=this;this.targetFrame=t,this.options=e,this.messagesEmitter=new o.EventEmitter,this.readyPromise=void 0,this.handleMessage=function(t){if(-1!==c.indexOf(t.origin)){var e=f(t),n=e.type,i=e.data;r.messagesEmitter.emit(n,i)}}}return t.prototype.init=function(){window.addEventListener("message",this.handleMessage),this.waitForReady().catch(function(t){console.error("There was an error waiting for ready",t)})},t.prototype.destroy=function(){window.removeEventListener("message",this.handleMessage)},t.prototype.sendMessage=function(t){var e=this,r=this.targetFrame.contentWindow;if(!r)throw Error('can not send message "'+JSON.stringify(t)+'", no contentWindow');this.waitForReady().then(function(){r.postMessage(t,e.getTargetOrigin())}).catch(function(t){console.error("There was an error waiting for ready",t)})},t.prototype.waitForMessage=function(t){var e=this;return new Promise(function(r){e.messagesEmitter.once(t,function(t){r(t)})})},t.prototype.waitForClose=function(){return this.waitForMessage(s.FRAME_CLOSE)},t.prototype.waitForImageData=function(){return this.waitForMessage(s.IMAGE_DATA).then(function(t){var e=t.imageBuffer,r=t.mime;return new Blob([new Uint8Array(e)],{type:r})})},t.prototype.waitForReady=function(){return this.readyPromise||(this.readyPromise=this.waitForMessage(s.READY)),this.readyPromise},t.prototype.getTargetOrigin=function(){return this.options.debug?"http://local.wix.com:3010":"https://apps.wix.com/media-image-studio"},t}();!function(t){t.Prod="https://apps.wix.com/media-image-studio",t.Local="http://local.wix.com:3010"}(u||(u={}));var l=function(){function t(t){var e=t.url,r=void 0===e?u.Prod:e,i=t.title,s=void 0===i?"Media Image Studio":i,a=t.appendTo,c=void 0===a?document.body:a,f=t.mode,p=void 0===f?n.Default:f,l=t.initiator,d=void 0===l?"Unknown":l,h=t.mediaRoot,m=void 0===h?"":h,v=t.metasiteId,y=void 0===v?"":v,b=t.fileId,g=void 0===b?"":b,w=t.siteToken,E=t.isUserLevelFile,T=void 0!==E&&E;this.transport=void 0,this.iframe=void 0,this.messageEmitter=new o.EventEmitter,this.url=r,this.title=s,this.appendTo=c,this.fileId=g,this.siteToken=w,this.mode=p,this.initiator=d,this.mediaRoot=m,this.metasiteId=y,this.isUserLevelFile=T}return t.prototype.preload=function(){this.iframe=this.init(),this.hide()},t.prototype.sendClose=function(){this.emitMessage({type:i.Close,payload:void 0})},t.prototype.hide=function(){this.iframe&&(this.sendClose(),this.iframe.style.display="none")},t.prototype.kill=function(){if(this.iframe){var t=this.iframe.parentNode;t&&t.removeChild(this.iframe),this.iframe=void 0,this.transport&&(this.transport.destroy(),this.transport=void 0),this.sendClose(),this.messageEmitter.removeAllListeners()}},t.prototype.show=function(t){var e=this;void 0===t&&(t={});var r=Math.floor(Math.random()*Number.MAX_SAFE_INTEGER),n=Date.now(),o=t.fileId,s=t.mode,a=(o||s)&&this.iframe;o&&(this.fileId=o),s&&(this.mode=s),this.iframe||(this.iframe=this.init());var u=this.iframe;if(a){if(!this.transport)throw Error("transport is not created when showing iframe");this.transport.sendMessage({type:"updateSettings",data:t})}this.transport||(this.transport=this.initTransport(u)),this.transport.sendMessage({type:"iframeRequested",data:{requestId:r,ts:n}}),this.transport.waitForClose().then(function(){e.hide()}).catch(function(t){console.error("Error waiting for close",t)}),this.transport.waitForImageData().then(function(t){e.emitMessage({type:i.ImageData,payload:t})}).catch(function(t){console.error("Error waiting for image",t)}),setTimeout(function(){var t=Date.now();if(!e.transport)throw new Error("transport is not inited");e.transport.sendMessage({type:"iframeAppeared",data:{requestId:r,ts:t}}),u.style.display="block";var n=u.contentWindow;n&&n.focus()},100)},t.prototype.on=function(t,e){return this.messageEmitter.addListener(t,e)},t.prototype.once=function(t,e){return this.messageEmitter.once(t,e)},t.prototype.emitMessage=function(t){this.messageEmitter.emit(t.type,t.payload)},t.prototype.getURL=function(){var t=this.url.replace(/\/$/,"");this.mode!==n.Default&&(t=t+"/"+this.mode);var e={fileId:this.fileId,siteToken:this.siteToken,initiator:this.initiator,metasiteId:this.metasiteId,isUserLevelFile:this.isUserLevelFile};return t+"?"+Object.keys(e).reduce(function(t,r){var n=e[r];if(!n)return t;var i=!0===n?"true":n;return t.concat([r+"="+encodeURIComponent(i)])},[]).join("&")},t.prototype.initTransport=function(t){var e=function(t,e){return void 0===e&&(e={debug:!1}),new p(t,e)}(t,{debug:this.url===u.Local});return e.init(),e},t.prototype.init=function(){var t=document.createElement("iframe");return t.src=this.getURL(),t.id="mediaImageStudio",t.className=a.mediaImageStudio,t.title=this.title,this.appendTo.appendChild(t),this.transport=this.initTransport(t),t},t}();r.d(e,"MediaImageStudioMode",function(){return n}),r.d(e,"MediaImageStudio",function(){return l}),r.d(e,"MediaImageStudioURL",function(){return u}),r.d(e,"MediaImageStudioEvents",function(){return i});e.default=l}])});
//# sourceMappingURL=MediaImageStudio.bundle.min.js.map